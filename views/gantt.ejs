<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizaci√≥n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="js/jsgantt_v12/jsgantt.css" />
</head>
<body>
  <div class="container">
    <div class="row mt-4 mb-4">
      <div class="col-12">
        <h3>Diagrama Gantt</h3>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <h5>Precio por hora: $ <%=costo_hora%></h5>
        <h5>Horas a la semana de trabajo: <%=horas_trabajo%></h5>
      </div>
    </div>
  </div>
    <div class="row mb-5">
        <div class="col">
          <div style="margin-left: 60px;" class="gantt" id="GanttChartDIV"></div>
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
      <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
      <script src="js/jsgantt_v12/jsgantt.js"></script>
      <script src="https://unpkg.com/gojs/release/go-debug.js"></script>
      <script>
        var condicion ='<%=actividad%>';
        if(condicion){
            var g = new JSGantt.GanttChart('g',document.getElementById('GanttChartDIV'), 'day');
            g.setShowRes(1); // Show/Hide Responsible (0/1)
            g.setShowComp(0); // Show/Hide % Complete(0/1)
            g.setDateDisplayFormat('yyyy-mm-dd') // Set format to display dates ('mm/dd/yyyy', 'dd/mm/yyyy', 'yyyy-mm-dd')
            g.setFormatArr("day") // Set format options (up to 4 : "minute","hour","day","week","month","quarter")
            actividad = '<%=actividad%>'.split(',');
            fecha_inicio ='<%=fecha_inicio%>'.split(',');
            fecha_termina = '<%=fecha_termina%>'.split(',');
            costo_hora= '<%=costo_hora%>';
            horas_trabajo = '<%=horas_trabajo%>';
            for (i = 0; i < actividad.length; i++) {
              var costo =calculoCostoFase(getNumberDays(fecha_inicio[i],fecha_termina[i]),horas_trabajo,costo_hora);
              g.AddTaskItem(new JSGantt.TaskItem(i,actividad[i],changeDateFormat(fecha_inicio[i]),changeDateFormat(fecha_termina[i]),'ff6666','','',`$ ${costo}`));
            }
            // TaskItem(pID, pName, pStart, pEnd, pColor, pLink, pMile, pRes, pComp, pGroup, pParent, pOpen, pDepend)
            g.Draw();	
            g.DrawDependencies();
        }

        function changeDateFormat(inputDate) {
            var splitDate = inputDate.split('-');
            if(splitDate.count == 0){
                return null;
            }
            var year = splitDate[0];
            var month = splitDate[1];
            var day = splitDate[2]; 
            return month + '/' + day + '/' + year;
        }

        function getNumberDays(fromDate,toDate){
          const diffInMs   = new Date(toDate) - new Date(fromDate)
          const diffInDays = diffInMs / (1000 * 60 * 60 * 24);
          return diffInDays + 1;
        }

        function calculoCostoFase(dias,horas_diarias,costo_hora){
          return dias *horas_diarias * costo_hora;
        }
      </script>
</body>
</html>